# Руководство по устранению неполадок

## Проблемы при запуске проекта

### Ошибка "Could not read package.json"
**Проблема**: При запуске `npm start` появляется ошибка:
```
npm error code ENOENT
npm error syscall open
npm error path /path/to/package.json
npm error errno -2
npm error enoent Could not read package.json: Error: ENOENT: no such file or directory, open '/path/to/package.json'
```

**Решение**:
1. Убедитесь, что вы находитесь в правильной директории проекта. Команду нужно выполнять в директории `opros-v-3-0/opros-v-3-0`, где находится файл `package.json`.
2. Выполните команду:
   ```
   cd /Users/avtandilyan.aa/Downloads/Opros-v-3-0/opros-v-3-0
   npm start
   ```

### Ошибка "Something is already running on port 3000"
**Проблема**: При запуске появляется сообщение о том, что порт 3000 уже занят:
```
? Something is already running on port 3000. Probably:
  /usr/local/bin/node /path/to/node_modules/react-scripts/scripts/start.js (pid XXXX)
```

**Решение**:
1. Нажмите `Y` для запуска на другом порту.
2. Или остановите процесс, который занимает порт 3000:
   ```
   kill -9 XXXX  # Где XXXX - PID процесса
   ```
3. Или укажите другой порт при запуске:
   ```
   npm start -- --port 3001
   ```

### Ошибки компиляции TypeScript
**Проблема**: При запуске появляются ошибки TypeScript:
```
ERROR in src/store/slices/profileSlice.ts:10:5
TS2322: Type '(state: null, action: { payload: ProfileData; type: string; }) => ProfileData' is not assignable to type...
```

**Решение**:
1. Проверьте типы в файлах, указанных в ошибках.
2. Убедитесь, что начальное состояние в `profileSlice.ts` не является `null`, а имеет структуру `ProfileData`.
3. Проверьте обработку возможных значений `undefined` в `answersSlice.ts`.

## Проблемы с интеграцией Google Sheets

### Ошибка CORS при отправке данных
**Проблема**: При отправке данных в Google Sheets появляется ошибка CORS:
```
Access to fetch at 'https://script.google.com/...' from origin 'http://localhost:3000' has been blocked by CORS policy
```

**Решение**:
1. Настройте CORS в Google Apps Script (см. раздел 5 в DEPLOYMENT_GUIDE.md).
2. Убедитесь, что веб-приложение опубликовано с доступом "Все, даже анонимные пользователи".
3. Проверьте, что URL веб-приложения правильно указан в файле `src/utils/api.ts`.

### Ошибка аутентификации API ключа
**Проблема**: При отправке данных появляется ошибка "Неверный API ключ".

**Решение**:
1. Проверьте, что значение `API_KEY` в файле `src/utils/api.ts` совпадает со значением в Google Apps Script.
2. Убедитесь, что заголовок `X-API-Key` правильно передается в запросе.

### Данные не сохраняются в Google Sheets
**Проблема**: Запрос отправляется успешно, но данные не появляются в таблице.

**Решение**:
1. Проверьте, что ID таблицы в Google Apps Script указан правильно.
2. Убедитесь, что у скрипта есть права на запись в таблицу.
3. Проверьте логи выполнения в Google Apps Script (меню "Выполнение" > "Текущие логи выполнения").

## Проблемы с сохранением состояния

### Состояние не сохраняется при перезагрузке страницы
**Проблема**: При перезагрузке страницы теряется прогресс прохождения тестов.

**Решение**:
1. Проверьте, что localStorage доступен в вашем браузере.
2. Убедитесь, что функции сохранения состояния вызываются при изменении данных.
3. Проверьте, нет ли ошибок в консоли браузера.

### Ошибка при восстановлении состояния
**Проблема**: При попытке восстановить состояние из localStorage возникают ошибки.

**Решение**:
1. Очистите localStorage в браузере и начните тестирование заново.
2. Проверьте, что структура данных в localStorage соответствует ожидаемой.
3. Добавьте дополнительные проверки при загрузке данных из localStorage.

## Проблемы с отображением

### Компоненты отображаются некорректно
**Проблема**: Некоторые компоненты отображаются неправильно или не отображаются вообще.

**Решение**:
1. Проверьте консоль браузера на наличие ошибок JavaScript.
2. Убедитесь, что все необходимые стили загружены.
3. Проверьте, что все пропсы передаются корректно.

### Проблемы с адаптивностью
**Проблема**: Сайт некорректно отображается на мобильных устройствах.

**Решение**:
1. Добавьте мета-тег viewport в `public/index.html`:
   ```html
   <meta name="viewport" content="width=device-width, initial-scale=1" />
   ```
2. Используйте медиа-запросы для адаптации стилей под разные размеры экрана.
3. Тестируйте на разных устройствах или с помощью инструментов разработчика в браузере.

## Проблемы с производительностью

### Приложение работает медленно
**Проблема**: Приложение загружается или работает медленно.

**Решение**:
1. Оптимизируйте размер бандла:
   - Используйте динамический импорт для разделения кода.
   - Оптимизируйте зависимости.
2. Оптимизируйте рендеринг компонентов:
   - Используйте `React.memo` для предотвращения ненужных ререндеров.
   - Используйте `useCallback` и `useMemo` для мемоизации функций и значений.
3. Оптимизируйте работу с Redux:
   - Используйте селекторы для доступа к состоянию.
   - Избегайте ненужных обновлений состояния.

### Утечки памяти
**Проблема**: Приложение потребляет всё больше памяти со временем.

**Решение**:
1. Проверьте, что все подписки и интервалы очищаются в `useEffect`:
   ```javascript
   useEffect(() => {
     const interval = setInterval(() => {
       // ...
     }, 1000);
     
     return () => clearInterval(interval);
   }, []);
   ```
2. Используйте инструменты профилирования в браузере для обнаружения утечек памяти.

## Прочие проблемы

### Проблемы с маршрутизацией
**Проблема**: Некоторые маршруты не работают или происходит перенаправление на несуществующие страницы.

**Решение**:
1. Проверьте настройку маршрутов в `App.tsx`.
2. Убедитесь, что компоненты для всех маршрутов существуют и импортированы.
3. При использовании HashRouter вместо BrowserRouter для статического хостинга, убедитесь, что все ссылки используют правильный формат.

### Проблемы с отправкой email
**Проблема**: Email с результатами не отправляется.

**Решение**:
1. Проверьте, что функция отправки email в Google Apps Script работает корректно.
2. Убедитесь, что у скрипта есть права на отправку email.
3. Проверьте ограничения Google Apps Script на количество отправляемых email в день.

### Общие рекомендации по отладке
1. Используйте `console.log` для отладки значений переменных.
2. Проверяйте консоль браузера на наличие ошибок.
3. Используйте инструменты разработчика в браузере для отладки сетевых запросов и состояния приложения.
4. При необходимости используйте инструменты профилирования для выявления узких мест в производительности.
